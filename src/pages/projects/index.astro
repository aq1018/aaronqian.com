---
// Projects Index Page - Full listing of all projects
import { markLatestProjectAsLive, sortProjectsByLatestLog } from '@/lib/projects'
import BaseLayout from '@/layouts/BaseLayout.astro'
import { getCollection } from 'astro:content'
import ProjectsIndex from '@/components/pages/ProjectsIndex.astro'
import { staticPages } from '@/config/pages'

// Fetch and sort projects by latest log
const projects = await getCollection('projects')
const projectLogs = await getCollection('projectLogs')

const sortedProjects = sortProjectsByLatestLog(projects, projectLogs)
const projectsWithLive = markLatestProjectAsLive(sortedProjects, projectLogs)

const { title, description } = staticPages.projects
const ogImage = '/og/projects.png'
---

<BaseLayout {title} {description} image={ogImage}>
  <ProjectsIndex projects={projectsWithLive} />
</BaseLayout>
