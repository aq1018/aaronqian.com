---
// ProjectLogEntry - Terminal-style log entry component
import type { CollectionEntry } from 'astro:content'

interface Props {
  log: CollectionEntry<'projectLogs'>
}

const { log } = Astro.props
const { Content } = await log.render()

// Format date as [YYYY-MM-DD HH:MM]
const formatTimestamp = (date: Date) => {
  const year = date.getFullYear()
  const month = String(date.getMonth() + 1).padStart(2, '0')
  const day = String(date.getDate()).padStart(2, '0')
  const hours = String(date.getHours()).padStart(2, '0')
  const minutes = String(date.getMinutes()).padStart(2, '0')
  return `${year}-${month}-${day} ${hours}:${minutes}`
}

// Tag colors (terminal aesthetic)
const tagColors: Record<string, string> = {
  milestone: 'bg-accent/20 text-accent border-accent/40',
  bug: 'bg-red-500/20 text-red-400 border-red-500/40',
  experiment: 'bg-primary-500/20 text-primary-400 border-primary-500/40',
  ux: 'bg-purple-500/20 text-purple-400 border-purple-500/40',
  default: 'bg-muted/20 text-muted border-border',
}

const getTagColor = (tag: string) => {
  return tagColors[tag.toLowerCase()] || tagColors.default
}
---

<article class="group border-l-2 border-border/30 pl-6 transition-colors hover:border-accent/50">
  <!-- Timestamp and title -->
  <header class="mb-3">
    <time datetime={log.data.date.toISOString()} class="font-mono text-xs text-muted/70">
      [{formatTimestamp(log.data.date)}]
    </time>
    <h3 class="mt-1 font-mono text-lg font-semibold text-fg">
      {log.data.title}
    </h3>
  </header>

  <!-- Tags -->
  {
    log.data.tags.length > 0 && (
      <div class="mb-4 flex flex-wrap gap-2">
        {log.data.tags.map((tag) => (
          <span
            class={`rounded border px-2 py-0.5 font-mono text-xs font-medium ${getTagColor(tag)}`}
          >
            {tag}
          </span>
        ))}
      </div>
    )
  }

  <!-- Log content (markdown) -->
  <div
    class="prose prose-sm prose-invert max-w-none font-mono text-sm leading-relaxed text-muted prose-headings:font-mono prose-headings:text-fg prose-p:text-muted prose-a:text-link prose-a:underline prose-a:decoration-transparent prose-a:transition-colors hover:prose-a:decoration-link prose-strong:text-fg prose-code:rounded prose-code:bg-surface-hover prose-code:px-1 prose-code:py-0.5 prose-code:font-mono prose-code:text-accent prose-pre:bg-surface-hover prose-pre:text-fg prose-ul:text-muted prose-ol:text-muted"
  >
    <Content />
  </div>
</article>
