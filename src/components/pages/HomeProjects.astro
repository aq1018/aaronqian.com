---
import { getCollection } from 'astro:content'

import ProjectList from '@/components/features/ProjectList.astro'
import Container from '@/components/primitives/Container.astro'
import Heading from '@/components/primitives/Heading.astro'
import Stack from '@/components/primitives/Stack.astro'
import Surface from '@/components/primitives/Surface.astro'
import { markLatestProjectAsLive, sortProjectsByLatestLog } from '@/lib/projects'

const allProjects = await getCollection('projects')
const projectLogs = await getCollection('projectLogs')
const sortedProjects = sortProjectsByLatestLog(allProjects, projectLogs)
const projectsWithLive = markLatestProjectAsLive(sortedProjects, projectLogs)
const featuredProjects = projectsWithLive.slice(0, 3)
---

<Surface id="projects">
  <Container>
    <Stack space="lg">
      <Heading size="h2"> Now / Currently Building </Heading>
      <ProjectList projects={featuredProjects} footer="Updates monthly. Expect context switches." />
    </Stack>
  </Container>
</Surface>
