---
import type { CollectionEntry } from 'astro:content'

import ProjectLogEntry from '@/components/features/ProjectLogEntry.astro'
import Badge from '@/components/primitives/Badge.astro'
import ButtonLink from '@/components/primitives/ButtonLink.astro'
import Container from '@/components/primitives/Container.astro'
import Divider from '@/components/primitives/Divider.astro'
import Heading from '@/components/primitives/Heading.astro'
import Link from '@/components/primitives/Link.astro'
import Sheet from '@/components/primitives/Sheet.astro'
import Stack from '@/components/primitives/Stack.astro'
import Surface from '@/components/primitives/Surface.astro'
import Text from '@/components/primitives/Text.astro'

export interface Props {
  project: CollectionEntry<'projects'>
  projectLogs: Array<CollectionEntry<'projectLogs'>>
  statusStyles: Record<string, string>
  statusLabels: Record<string, string>
}

const { project, projectLogs, statusStyles, statusLabels } = Astro.props
---

<!-- Project Header -->
<header>
  <Surface>
    <Container>
      <Stack space="sm">
        <!-- Back link -->
        <Link href="/projects" variant="back"> ← Back to projects </Link>

        <!-- Title and status -->
        <Stack direction="row" space="sm" class="flex-wrap" align="baseline">
          <Heading size="h1" class="text-3xl sm:text-4xl">
            {project.data.title}
          </Heading>
          <Badge size="md" uppercase class={statusStyles[project.data.status]}>
            {statusLabels[project.data.status]}
            {
              project.data.live && (
                <Badge color="primary" class="ml-2">
                  LIVE
                </Badge>
              )
            }
          </Badge>
        </Stack>

        <!-- Description -->
        <Text>
          {project.data.description}
        </Text>

        <!-- Aside (witty comment) -->
        <Text size="small" color="muted" class="italic">
          {project.data.aside}
        </Text>

        <!-- External link if available -->
        {
          project.data.url !== undefined && project.data.url !== '' && (
            <div class="mt-6">
              <ButtonLink href={project.data.url} external color="primary" class="text-sm">
                <span>Visit Site</span>
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                  />
                </svg>
              </ButtonLink>
            </div>
          )
        }

        <Divider />
      </Stack>
    </Container>
  </Surface>
</header>

<!-- Build Log -->
<main>
  <Surface>
    <Container>
      <Stack space="md">
        <!-- Log header -->
        <div>
          <Heading size="h2">Build Log</Heading>
          <Text class="mt-2" color="muted">
            {projectLogs.length}
            {projectLogs.length === 1 ? 'entry' : 'entries'} · Newest first
          </Text>
        </div>

        <Divider />

        <!-- Log entries -->
        {
          projectLogs.length > 0 ? (
            <Stack space="md">
              {projectLogs.map((log) => (
                <ProjectLogEntry log={log} />
              ))}
            </Stack>
          ) : (
            <Sheet variant="soft" color="neutral" padding="lg" class="text-center">
              <Text color="muted">No log entries yet. Check back soon.</Text>
            </Sheet>
          )
        }
      </Stack>
    </Container>
  </Surface>
</main>
