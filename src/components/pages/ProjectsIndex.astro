---
import type { CollectionEntry } from 'astro:content'
import CuttingMat from '@/components/features/CuttingMat.astro'

interface Props {
  projects: CollectionEntry<'projects'>[]
  statusStyles: Record<string, string>
  statusLabels: Record<string, string>
}

const { projects, statusStyles, statusLabels } = Astro.props
---

<!-- Hero Section -->
<CuttingMat class="cutting-mat py-16 sm:py-20">
  <div class="relative z-10 mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8">
    <!-- Eyebrow -->
    <div class="mb-4 font-mono text-xs font-medium uppercase tracking-wide text-primary opacity-85">
      PROJECT ARCHIVE
    </div>

    <!-- Title -->
    <h1 class="font-mono text-4xl font-bold text-fg sm:text-5xl">Projects / Lab Notes</h1>

    <!-- Animated accent line -->
    <div
      class="mx-auto mt-3 h-0.5 w-20 bg-primary transition-all duration-200 hover:w-28 hover:shadow-[0_0_8px_rgba(var(--color-primary-raw),0.6)]"
    >
    </div>

    <!-- Blurb -->
    <p class="mx-auto mt-8 max-w-2xl text-lg leading-relaxed text-muted">
      My digital workshop — half experiments, half excuses to learn new tools.
    </p>

    <!-- Micro-line -->
    <p class="mt-4 font-mono text-xs text-muted/70">
      <span class="text-primary">⚠️</span> Some projects are still in beta. Including me.
    </p>
  </div>
</CuttingMat>

<!-- Projects Content -->
<main class="bg-surface py-16 sm:py-20">
  <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
    <!-- Projects table - desktop -->
    <div class="hidden md:block overflow-x-auto">
      <table class="w-full border-collapse font-mono text-sm">
        <thead>
          <tr class="border-b border-border/30">
            <th class="pb-3 pr-6 text-left font-semibold uppercase tracking-wide text-muted/70"
              >Project</th
            >
            <th class="pb-3 px-6 text-right font-semibold uppercase tracking-wide text-muted/70"
              >Status</th
            >
            <th class="pb-3 pl-6 text-left font-semibold uppercase tracking-wide text-muted/70"
              >Notes</th
            >
          </tr>
        </thead>
        <tbody>
          {
            projects.map((project) => (
              <tr class="group border-b border-border/20 transition-colors hover:bg-surface-hover">
                <td class="py-4 pr-6 align-top">
                  <a
                    href={`/projects/${project.id.replace(/\/index(\.md)?$/, '')}`}
                    class="font-semibold text-link underline decoration-transparent transition-colors hover:decoration-link"
                  >
                    {project.data.title}
                  </a>
                </td>
                <td class="py-4 px-6 align-top text-right">
                  <span
                    class={`font-bold uppercase tracking-wider ${statusStyles[project.data.status]}`}
                  >
                    {statusLabels[project.data.status]}
                    {project.data.live && (
                      <span class="ml-2 rounded bg-primary px-2 py-0.5 text-xs font-bold text-gray-950 animate-pulse-subtle">
                        LIVE
                      </span>
                    )}
                  </span>
                </td>
                <td class="py-4 pl-6 align-top">
                  <p class="mb-2 leading-relaxed text-muted">{project.data.description}</p>
                  <p class="text-xs italic text-muted/60">{project.data.aside}</p>
                </td>
              </tr>
            ))
          }
        </tbody>
      </table>
    </div>

    <!-- Projects list - mobile -->
    <div class="space-y-6 md:hidden">
      {
        projects.map((project) => (
          <div class="border-l-2 border-primary/30 pl-4 transition-colors hover:border-primary">
            <div class="mb-2 flex items-baseline justify-between gap-3">
              <a
                href={`/projects/${project.id.replace(/\/index(\.md)?$/, '')}`}
                class="font-mono text-base font-semibold text-link underline decoration-transparent transition-colors hover:decoration-link"
              >
                {project.data.title}
              </a>
            </div>
            <div class="mb-3">
              <span
                class={`font-mono text-xs font-bold uppercase tracking-wider ${statusStyles[project.data.status]}`}
              >
                {statusLabels[project.data.status]}
                {project.data.live && (
                  <span class="ml-2 rounded bg-primary px-2 py-0.5 text-xs font-bold text-gray-950 animate-pulse-subtle">
                    LIVE
                  </span>
                )}
              </span>
            </div>
            <p class="mb-2 font-sans text-sm leading-relaxed text-muted">
              {project.data.description}
            </p>
            <p class="font-mono text-xs italic text-muted/60">{project.data.aside}</p>
          </div>
        ))
      }
    </div>

    <!-- Footer -->
    <div class="mt-12 border-t border-border/20 pt-6 text-center">
      <p class="font-mono text-xs text-muted/70">Updates monthly. Expect context switches.</p>
    </div>
  </div>
</main>

<style>
  @keyframes pulseSubtle {
    0%,
    100% {
      opacity: 1;
      box-shadow: 0 0 0 0 rgba(var(--color-primary-raw, 0 224 255), 0);
    }
    50% {
      opacity: 0.85;
      box-shadow: 0 0 8px 2px rgba(var(--color-primary-raw, 0 224 255), 0.4);
    }
  }

  .animate-pulse-subtle {
    animation: pulseSubtle 3s ease-in-out infinite;
  }
</style>
