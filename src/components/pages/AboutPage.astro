---
import { Image } from 'astro:assets'
import { getCollection, getEntry, type CollectionEntry } from 'astro:content'

import SocialsBar from '@/components/features/SocialsBar.astro'
import TestimonialStrip from '@/components/features/TestimonialStrip.astro'
import ToolsGrid from '@/components/features/ToolsGrid.astro'
import ButtonLink from '@/components/primitives/ButtonLink.astro'
import Container from '@/components/primitives/Container.astro'
import Heading from '@/components/primitives/Heading.astro'
import Overlay from '@/components/primitives/Overlay.astro'
import Prose from '@/components/primitives/Prose.astro'
import Stack from '@/components/primitives/Stack.astro'
import Surface from '@/components/primitives/Surface.astro'
import Text from '@/components/primitives/Text.astro'

// Fetch all data
const aboutEntry = await getEntry('about', 'main')
if (aboutEntry === undefined) {
  throw new Error('About entry not found')
}

const devTools = (
  await getCollection('devTools', ({ data }: CollectionEntry<'devTools'>) => data.enabled)
).toSorted(
  (a: CollectionEntry<'devTools'>, b: CollectionEntry<'devTools'>) =>
    a.data.position - b.data.position,
)
const benchTools = (
  await getCollection('benchTools', ({ data }: CollectionEntry<'benchTools'>) => data.enabled)
).toSorted(
  (a: CollectionEntry<'benchTools'>, b: CollectionEntry<'benchTools'>) =>
    a.data.position - b.data.position,
)

const { data } = aboutEntry
const { Content } = await aboutEntry.render()
---

<!-- Hero Section -->
<Surface padY="lg">
  <Overlay slot="background" preset="soft" />
  <Container width="narrow">
    <Stack space="lg" align="center">
      <Image
        src={data.heroImage}
        alt={data.heroImageAlt}
        width={1200}
        height={630}
        class="rounded-lg"
      />
      <Stack space="md" align="center">
        <Heading as="h1" size="display-1" align="center">
          {data.name}
        </Heading>
        <Text size="lead" align="center" color="muted">
          {data.tagline}
        </Text>
        <SocialsBar variant="wide" />
      </Stack>
    </Stack>
  </Container>
</Surface>

<!-- Testimonials Section -->
<Surface padY="md">
  <Container width="narrow">
    <TestimonialStrip />
  </Container>
</Surface>

<!-- About & Working Style Section -->
<Surface padY="lg">
  <Container width="narrow">
    <Stack space="xl">
      <Stack space="md">
        <Heading as="h2" size="h2"> About </Heading>
        <Prose>
          <Content />
        </Prose>
      </Stack>

      <Stack space="md">
        <Heading as="h3" size="h3"> How I Work </Heading>
        <ul class="list-disc space-y-2 pl-6">
          {
            data.workingStyle.map((item: string) => (
              <Text as="li" size="body">
                {item}
              </Text>
            ))
          }
        </ul>
      </Stack>
    </Stack>
  </Container>
</Surface>

<!-- CTA Section -->
<Surface padY="lg" class="bg-accent/5">
  <Container width="narrow">
    <Stack space="md" align="center">
      <Heading as="h2" size="h2" align="center"> Let's Work Together </Heading>
      {
        data.availability !== undefined && (
          <Text size="body" align="center" color="muted">
            {data.availability}
          </Text>
        )
      }
      <ButtonLink
        href="https://launchpath.tech/services"
        variant="solid"
        color="primary"
        size="lg"
        external
      >
        Work with me â†’
      </ButtonLink>
    </Stack>
  </Container>
</Surface>

<!-- Dev Tools Section -->
<Surface padY="lg">
  <Container>
    <ToolsGrid tools={devTools} title="Dev Tools" />
  </Container>
</Surface>

<!-- Bench Tools Section -->
<Surface padY="lg">
  <Container>
    <ToolsGrid tools={benchTools} title="Bench Tools" />
  </Container>
</Surface>
