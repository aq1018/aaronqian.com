---
/**
 * Creates angle degree labels with background halos
 * Note: Background color detection happens client-side via CSS
 */

interface Props {
  width: number
  height: number
  angleLineCount: number
  angleLabelArcIndex: number
  majorLineInterval: number
  labelOpacity: number
}

const { width, height, angleLineCount, angleLabelArcIndex, majorLineInterval, labelOpacity } =
  Astro.props

const centerX = width / 2
const bottomY = height

// Calculate angles (30° to 150°, evenly distributed)
const startAngle = 30
const endAngle = 150
const angleRange = endAngle - startAngle
const angles = Array.from(
  { length: angleLineCount },
  (_, i) => startAngle + (i * angleRange) / (angleLineCount - 1),
)

// Calculate label distance (above the specified arc)
const arcRadiusInterval = 1 // default from original code
const arcRadius = (angleLabelArcIndex + 1) * arcRadiusInterval * majorLineInterval
const labelOffset = 20 // pixels above the arc
const labelDistance = arcRadius + labelOffset

const labels = angles.map((angle) => {
  const radians = (angle * Math.PI) / 180
  const labelX = centerX + labelDistance * Math.cos(radians)
  const labelY = bottomY - labelDistance * Math.sin(radians)
  const angleText = `${Math.round(angle)}°`
  return { labelX, labelY, angleText }
})
---

{
  labels.map(({ labelX, labelY, angleText }) => (
    <>
      {/* Text background/halo to hide line behind label */}
      <text
        x={labelX}
        y={labelY}
        fill="var(--color-background)"
        stroke="var(--color-background)"
        stroke-width="6"
        font-size="14"
        font-family="monospace"
        font-weight="300"
        text-anchor="middle"
        dominant-baseline="middle"
        paint-order="stroke"
      >
        {angleText}
      </text>

      {/* Text foreground (using currentColor) */}
      <text
        x={labelX}
        y={labelY}
        fill="currentColor"
        font-size="14"
        font-family="monospace"
        font-weight="300"
        text-anchor="middle"
        dominant-baseline="middle"
        opacity={labelOpacity}
      >
        {angleText}
      </text>
    </>
  ))
}
