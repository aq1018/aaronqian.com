---
import type { CollectionEntry } from 'astro:content'

import Grid from '@/components/primitives/Grid.astro'
import Heading from '@/components/primitives/Heading.astro'
import Link from '@/components/primitives/Link.astro'
import Sheet from '@/components/primitives/Sheet.astro'
import Stack from '@/components/primitives/Stack.astro'
import Text from '@/components/primitives/Text.astro'

export interface Props {
  tools: (CollectionEntry<'devTools'> | CollectionEntry<'benchTools'>)[]
  title?: string
  class?: string
}

const { tools, title, class: className } = Astro.props

// Group tools by category
const groupedTools: Record<string, typeof tools> = {}
for (const tool of tools) {
  const category = tool.data.category
  groupedTools[category] ??= []
  groupedTools[category].push(tool)
}

// Sort each category by position
for (const category in groupedTools) {
  if (Object.hasOwn(groupedTools, category)) {
    groupedTools[category].sort((a, b) => a.data.position - b.data.position)
  }
}
---

<Stack space="lg" class={className}>
  {
    title && (
      <Heading as="h2" size="h2">
        {title}
      </Heading>
    )
  }
  {
    Object.entries(groupedTools).map(([category, categoryTools]) => (
      <Stack space="md">
        <Heading as="h3" size="h3">
          {category}
        </Heading>
        <Grid columns={3} spacing="md">
          {categoryTools.map((tool) => (
            <Sheet variant="bar" padding="sm">
              <Stack space="xs">
                {tool.data.url == null ? (
                  <Heading as="h4" size="h6">
                    {tool.data.name}
                  </Heading>
                ) : (
                  <Link href={tool.data.url} external>
                    <Heading as="h4" size="h6">
                      {tool.data.name}
                    </Heading>
                  </Link>
                )}
                <Text size="small" color="muted">
                  {tool.data.blurb}
                </Text>
              </Stack>
            </Sheet>
          ))}
        </Grid>
      </Stack>
    ))
  }
</Stack>
