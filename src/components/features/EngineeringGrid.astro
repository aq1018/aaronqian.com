---
/** EngineeringGrid - Engineering paper dot grid with corner L-shapes and notes */
export interface CornerNotes {
  topLeft?: string
  topRight?: string
  bottomLeft?: string
  bottomRight?: string
}
export interface CornerVisibility {
  topLeft?: boolean
  topRight?: boolean
  bottomLeft?: boolean
  bottomRight?: boolean
}
export interface Props {
  spacing?: 'sm' | 'md' | 'lg'
  dotSize?: number
  dotOpacity?: number
  cornerOpacity?: number
  cornerSize?: number
  corners?: CornerNotes
  showCorners?: CornerVisibility
  class?: string
}

const {
  spacing = 'md',
  dotSize = 1.5,
  dotOpacity = 0.3,
  cornerOpacity = 1,
  cornerSize = 40,
  corners = {},
  showCorners = { topLeft: true, topRight: true, bottomLeft: true, bottomRight: true },
  class: className,
} = Astro.props

// Dot spacing in pixels
const spacingMap = {
  sm: 20,
  md: 24,
  lg: 32,
}

const gridSpacing = spacingMap[spacing]
---

<div
  class={className}
  data-engineering-grid
  style={`
    --dot-size: ${dotSize}px;
    --dot-opacity: ${dotOpacity};
    --grid-spacing: ${gridSpacing}px;
    --corner-size: ${cornerSize}px;
    --corner-opacity: ${cornerOpacity};
  `}
>
  {showCorners.topLeft === true && <div class="corner corner--tl" />}
  {showCorners.topRight === true && <div class="corner corner--tr" />}
  {showCorners.bottomLeft === true && <div class="corner corner--bl" />}
  {showCorners.bottomRight === true && <div class="corner corner--br" />}

  {
    corners.topLeft != null && corners.topLeft !== '' && (
      <span class="label label--tl">{corners.topLeft}</span>
    )
  }
  {
    corners.topRight != null && corners.topRight !== '' && (
      <span class="label label--tr">{corners.topRight}</span>
    )
  }
  {
    corners.bottomLeft != null && corners.bottomLeft !== '' && (
      <span class="label label--bl">{corners.bottomLeft}</span>
    )
  }
  {
    corners.bottomRight != null && corners.bottomRight !== '' && (
      <span class="label label--br">{corners.bottomRight}</span>
    )
  }
</div>

<style>
  [data-engineering-grid] {
    position: relative;
    width: 100%;
    height: 100%;
    color: var(--color-primary);
    background-image: radial-gradient(
      circle at center,
      color-mix(in oklab, var(--color-muted), transparent calc(100% - var(--dot-opacity) * 100%))
        var(--dot-size),
      transparent 0
    );
    background-size: var(--grid-spacing) var(--grid-spacing);
    background-position: center;
  }

  .corner {
    position: absolute;
    width: var(--corner-size);
    height: var(--corner-size);
    opacity: var(--corner-opacity);
  }

  .corner--tl {
    top: var(--grid-spacing);
    left: var(--grid-spacing);
    border-top: 2px solid currentColor;
    border-left: 2px solid currentColor;
  }

  .corner--tr {
    top: var(--grid-spacing);
    right: var(--grid-spacing);
    border-top: 2px solid currentColor;
    border-right: 2px solid currentColor;
  }

  .corner--bl {
    bottom: var(--grid-spacing);
    left: var(--grid-spacing);
    border-bottom: 2px solid currentColor;
    border-left: 2px solid currentColor;
  }

  .corner--br {
    bottom: var(--grid-spacing);
    right: var(--grid-spacing);
    border-bottom: 2px solid currentColor;
    border-right: 2px solid currentColor;
  }

  .label {
    position: absolute;
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    font-weight: var(--font-weight-thin);
    letter-spacing: var(--tracking-widest);
    color: var(--color-primary);
  }

  .label--tl {
    top: calc(var(--grid-spacing) + 12px);
    left: calc(var(--grid-spacing) + 12px);
  }

  .label--tr {
    top: calc(var(--grid-spacing) + 12px);
    right: calc(var(--grid-spacing) + 12px);
    text-align: right;
  }

  .label--bl {
    bottom: calc(var(--grid-spacing) + 12px);
    left: calc(var(--grid-spacing) + 12px);
  }

  .label--br {
    bottom: calc(var(--grid-spacing) + 12px);
    right: calc(var(--grid-spacing) + 12px);
    text-align: right;
  }
</style>
