---
/**
 * Digital analyzer background component with dynamic sizing
 * Technical grid with animated signal traces
 * ViewBox and grid are calculated at runtime based on container dimensions
 */

import { defaultOptions } from './DigitalAnalyzer.config'
import type { DigitalAnalyzerOptions } from './DigitalAnalyzer.types'

interface Props extends Partial<DigitalAnalyzerOptions> {
  class?: string
}

const { class: className, ...options } = Astro.props

// Merge with defaults (runtime dimensions will be set by JavaScript)
const config = { ...defaultOptions, ...options }
---

<div class={`digital-analyzer relative ${className ?? ''}`} data-digital-analyzer>
  <slot />

  <!-- Static grid lines layer (viewBox set dynamically by JS) -->
  <svg
    class="digital-analyzer-static absolute inset-0 h-full w-full"
    preserveAspectRatio="none"
    style="pointer-events: none;"
  >
    <!-- Radial gradient mask for fading at edges -->
    <defs>
      <radialGradient id="digital-analyzer-fade">
        <stop offset="0%" stop-color="white" stop-opacity="0.8"></stop>
        <stop offset="70%" stop-color="white" stop-opacity="0.4"></stop>
        <stop offset="100%" stop-color="white" stop-opacity="0.1"></stop>
      </radialGradient>
      <mask id="digital-analyzer-mask">
        <!-- Rect dimensions set dynamically by JS -->
        <rect x="0" y="0" fill="url(#digital-analyzer-fade)"></rect>
      </mask>
    </defs>

    <!-- Grid lines populated dynamically by JS -->
    <g stroke="currentColor" class="text-primary" fill="none" mask="url(#digital-analyzer-mask)"
    ></g>
  </svg>

  <!-- Animated signal traces layer (viewBox and traces set dynamically by JS) -->
  <svg
    id="digital-analyzer-svg"
    class="digital-analyzer-traces absolute inset-0 h-full w-full"
    preserveAspectRatio="none"
    style="pointer-events: none;"
  >
    <!-- Traces added dynamically via hook -->
  </svg>
</div>
