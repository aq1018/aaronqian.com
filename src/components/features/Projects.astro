---
// Projects Section - Terminal-style status board
import { getCollection } from 'astro:content'
import Link from '@/components/primitives/Link.astro'
import Badge from '@/components/primitives/Badge.astro'
import Heading from '@/components/primitives/Heading.astro'
import Text from '@/components/primitives/Text.astro'
import Surface from '@/components/primitives/Surface.astro'
import Container from '@/components/primitives/Container.astro'
import Stack from '@/components/primitives/Stack.astro'
import Inline from '@/components/primitives/Inline.astro'

const projects = await getCollection('projects')
const sortedProjects = projects.sort((a, b) => a.data.order - b.data.order)

// Status indicator styles
const statusStyles = {
  active: 'text-primary',
  planning: 'text-muted',
  done: 'text-content/60',
}

const statusLabels = {
  active: 'ACTIVE',
  planning: 'PLANNING',
  done: 'DONE',
}
---

<Surface class="relative" id="projects">
  <Container>
    <!-- Section header -->
    <div class="mb-12">
      <Heading size="h2" class="sm:text-3xl">Now / Currently Building</Heading>
    </div>

    <!-- Projects table - desktop -->
    <div class="hidden md:block overflow-x-auto">
      <table class="w-full border-collapse font-mono text-sm">
        <thead>
          <tr class="border-b border-border/30">
            <th class="pb-3 pr-6 text-left font-semibold uppercase tracking-wide text-muted/70"
              >Project</th
            >
            <th class="pb-3 px-6 text-right font-semibold uppercase tracking-wide text-muted/70"
              >Status</th
            >
            <th class="pb-3 pl-6 text-left font-semibold uppercase tracking-wide text-muted/70"
              >Notes</th
            >
          </tr>
        </thead>
        <tbody>
          {
            sortedProjects.map((project) => (
              <tr class="group border-b border-border/20 transition-colors hover:bg-muted/10">
                <td class="py-4 pr-6 align-top">
                  <Link
                    href={`/projects/${project.id.replace(/\/index(\.md)?$/, '')}`}
                    class="font-semibold"
                  >
                    {project.data.title}
                  </Link>
                </td>
                <td class="py-4 px-6 align-top text-right">
                  <span
                    class={`font-bold uppercase tracking-wider ${statusStyles[project.data.status]}`}
                  >
                    {statusLabels[project.data.status]}
                    {project.data.live && (
                      <Badge color="primary" pulse={true} class="ml-2">
                        LIVE
                      </Badge>
                    )}
                  </span>
                </td>
                <td class="py-4 pl-6 align-top">
                  <Text class="mb-2 leading-relaxed">{project.data.description}</Text>
                  <Text size="xs" class="italic text-muted/60">
                    {project.data.aside}
                  </Text>
                </td>
              </tr>
            ))
          }
        </tbody>
      </table>
    </div>

    <!-- Projects list - mobile -->
    <Stack space="sm" class="md:hidden">
      {
        sortedProjects.map((project) => (
          <div class="border-l-2 border-primary/30 pl-4 transition-colors hover:border-primary">
            <Inline space="xs" class="mb-2 items-baseline justify-between">
              <Link
                href={`/projects/${project.id.replace(/\/index(\.md)?$/, '')}`}
                class="font-mono text-base font-semibold"
              >
                {project.data.title}
              </Link>
            </Inline>
            <div class="mb-3">
              <span
                class={`font-mono text-xs font-bold uppercase tracking-wider ${statusStyles[project.data.status]}`}
              >
                {statusLabels[project.data.status]}
                {project.data.live && (
                  <Badge color="primary" pulse={true} class="ml-2">
                    LIVE
                  </Badge>
                )}
              </span>
            </div>
            <Text size="sm" class="mb-2 leading-relaxed">
              {project.data.description}
            </Text>
            <Text size="xs" class="italic text-muted/60">
              {project.data.aside}
            </Text>
          </div>
        ))
      }
    </Stack>

    <!-- Footer -->
    <div class="mt-8">
      <Text class="text-muted/70">Updates monthly. Expect context switches.</Text>
    </div>
  </Container>
</Surface>
