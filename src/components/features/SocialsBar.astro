---
import { getCollection } from 'astro:content'
import type { CollectionEntry } from 'astro:content'

import Icon from '@/components/primitives/Icon.astro'
import Link from '@/components/primitives/Link.astro'
import Stack from '@/components/primitives/Stack.astro'

export interface Props {
  variant?: 'compact' | 'wide'
  class?: string
}

const { variant = 'compact', class: className } = Astro.props

// Fetch enabled socials sorted by position
const socialsCollection = await getCollection(
  'socials',
  ({ data }: CollectionEntry<'socials'>) => data.enabled,
)
const socials = socialsCollection.toSorted(
  (a: CollectionEntry<'socials'>, b: CollectionEntry<'socials'>) =>
    a.data.position - b.data.position,
)

// Type-safe socials array for mapping
const typedSocials: CollectionEntry<'socials'>[] = socials

// Map social labels to icon names
function getIconName(label: string): string {
  const iconMap: Record<string, string> = {
    Bluesky: 'heroicons:cloud',
    CodePen: 'heroicons:code-bracket-square',
    Discord: 'heroicons:chat-bubble-bottom-center-text',
    Email: 'heroicons:envelope',
    GitHub: 'heroicons:code-bracket',
    LinkedIn: 'heroicons:user-circle',
    Mastodon: 'heroicons:chat-bubble-left-right',
    Twitch: 'heroicons:tv',
    Twitter: 'heroicons:at-symbol',
    YouTube: 'heroicons:video-camera',
  }
  return iconMap[label] ?? 'heroicons:link'
}

const showLabels = variant === 'wide'
---

<Stack direction="row" space="sm" align="center" class={className}>
  {
    typedSocials.map((social) => (
      <Link
        href={social.data.url}
        rel={social.data.rel}
        aria-label={`${social.data.label} profile`}
        variant="nav"
      >
        <Stack direction="row" space="xs" align="center">
          <Icon name={getIconName(social.data.label)} size="md" />
          {showLabels && <span>{social.data.label}</span>}
        </Stack>
      </Link>
    ))
  }
</Stack>
