---
import type { HTMLAttributes } from 'astro/types'

import { type ButtonVariants, buttonVariants } from './Button.cva'

import { cn } from '@/lib/utils'

export interface Props extends Omit<HTMLAttributes<'a'>, 'color'>, ButtonVariants {
  href: string
  external?: boolean
  target?: string
  rel?: string
  class?: string
}

const {
  variant,
  color,
  size,
  fullWidth,
  class: className = '',
  href,
  external,
  target,
  rel,
  ...rest
} = Astro.props

// Auto-detect external links
const isExternal =
  external === true || (href.startsWith('http') && !href.includes(Astro.site?.hostname ?? ''))

// Set target and rel for external links
const linkTarget = target ?? (isExternal ? '_blank' : undefined)
const linkRel = rel ?? (isExternal ? 'noopener noreferrer' : undefined)
---

<a
  {href}
  target={linkTarget}
  rel={linkRel}
  class={cn(buttonVariants({ variant, color, size, fullWidth }), className)}
  {...rest}
>
  <slot />
</a>
